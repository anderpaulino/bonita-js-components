angular.module("bonitable",[]).controller("BonitableController",["$scope",function(e){function t(e){return e.isChecked()}function n(e){return e.data}this.getOptions=function(){return e.sortOptions},this.triggerSortHandler=function(t){e.onSort({options:t})};var r=[];this.registerSelector=function(e){r.push(e)},this.unregisterSelector=function(e){var t=r.indexOf(e);r=r.slice(0,t).concat(r.slice(t+1))};var o={$selectedItems:function(){return r.filter(t).map(n)},$allSelected:function(){return this.$selectedItems.length===r.length},$indeterminate:function(){return this.$selectedItems.length!==r.length&&this.$selectedItems.length>0}};this.prepareScope=function(e){Object.keys(o).forEach(function(e){Object.defineProperty(this,e,{get:o[e],enumerable:!0,iterable:!0})},e),e.$toggleAll=function(){var e=!this.$allSelected;r.forEach(function(t){t.setChecked(e)})}}}]).directive("bonitable",function(){return{priority:100,scope:{onSort:"&",sortOptions:"=",repeatableConfig:"="},transclude:"element",controller:"BonitableController",compile:function(){return function(e,t,n,r,o){o(function(e,n){r.prepareScope(n),t.after(e)})}}}}),angular.module("bonita.dragAndDrop",[]).provider("boDraggableItem",function(){"use strict";var e={cloneOnDrop:!0};this.cloneOnDrop=function(t){e.cloneOnDrop=t},this.$get=function(){return{config:function(){return angular.copy(e)},allowCloneOnDrop:function(){return this.config().cloneOnDrop||!1}}}}).service("boDragUtils",function(){"use strict";this.generateUniqId=function(e){return(e||"drag-")+Math.random().toString(36).substring(7)}}).directive("boDropzone",["$document","$parse","$compile","boDragUtils","boDragEvent","boDraggableItem",function(e,t,n,r,o,a){"use strict";function i(e,t){e.className=e.className.replace(new RegExp(" "+t),"")}var l={},c=o.events.DROPZONE_CLASSNAME_HOVER,u=o.events.CLASSNAME_DRAG_HOVER;return e.on("dragover",function(e){return e.preventDefault(),e.target.hasAttribute("data-drop-id")?(-1===e.target.className.indexOf(c)&&(angular.element(document.getElementsByClassName(c)).removeClass(c),e.target.className+=" "+c),l[e.target.getAttribute("data-drop-id")].onDragOver(angular.element(e.target).scope(),{$event:e}),(e.dataTransfer||e.originalEvent.dataTransfer).dropEffect="copy",!1):void 0}),e.on("drop",function(e){if(e.preventDefault(),e.target.hasAttribute("data-drop-id")){var t=e.target.getAttribute("data-drop-id"),s=(e.dataTransfer||e.originalEvent.dataTransfer).getData("Text").split(":"),p=document.getElementById(s[0]),d=angular.element(e.target).scope(),g=d.$new(),f=angular.element(p).isolateScope().data||angular.element(p).scope().data;if("false"===s[1]){var b=p.cloneNode(!0);b.id=r.generateUniqId(),o.copy(s[0],b.id);try{b.attributes.removeNamedItem("ng-repeat")}catch(e){}return a.allowCloneOnDrop()&&e.target.appendChild(b),g.data=f,n(angular.element(b))(g),void d.$apply(function(){i(e.target,c),i(e.target,u),l[t].onDropSuccess(d,{$data:g.data,$event:e})})}d.$apply(function(){i(e.target,c),i(e.target,u),l[t].onDropSuccess(d,{$data:f,$event:e})}),e.target.appendChild(p)}}),{type:"A",link:function(e,n,o){n.addClass("bo-dropzone-container"),o.$set("data-drop-id",r.generateUniqId("drop")),l[o["data-drop-id"]]={onDropSuccess:t(o.boDropSuccess)||angular.noop,onDragOver:t(o.boDragOver)||angular.noop}}}}]).factory("boDragEvent",function(){var e={};return{map:e,events:{DROPZONE_CLASSNAME_HOVER:"bo-dropzone-hover",CLASSNAME_DRAG_HOVER:"bo-drag-enter"},copy:function(t,n){e[n]=e[t]}}}).directive("boDraggable",["$document","boDragEvent","boDragUtils",function(e,t,n){"use strict";return e.on("dragstart",function(e){var n=e.target,r=e.dataTransfer||e.originalEvent.dataTransfer;r.effectAllowed="copy",r.setData("Text",n.id+":"+n.parentElement.hasAttribute("data-drop-id")),t.map[n.id]&&t.map[n.id].onDragStart()}),e.on("dragenter",function(e){e.target.className.indexOf(t.events.CLASSNAME_DRAG_HOVER)>-1||(e.target.className+=" "+t.events.CLASSNAME_DRAG_HOVER)}),e.on("dragleave",function(e){e.target.className.indexOf(t.events.CLASSNAME_DRAG_HOVER)>-1&&(e.target.className=e.target.className.replace(" "+t.events.CLASSNAME_DRAG_HOVER,""))}),{type:"EA",scope:{data:"=boDraggableData",onDragStart:"&boDragStart"},link:function(e,r,o){o.$set("draggable",!0),o.$set("id",o.id||n.generateUniqId()),o.boDragStart&&(t.map[o.id]={onDragStart:e.onDragStart||angular.noop})}}}]).directive("boDragPolyfill",["$window","$timeout","$rootScope","$compile",function(e,t,n,r){"use strict";function o(e){var t,o;Array.prototype.forEach.call(e,function(e){t=angular.element(e).isolateScope().data,o=n.$new(!0,angular.element(e).isolateScope()),o.data=t;var a=document.createElement("A");[].forEach.call(e.attributes,function(e){a.setAttribute(e.name,e.value)}),a.innerHTML=e.innerHTML,a.href="#",e.parentNode.replaceChild(a,e),r(angular.element(a))(o)})}return{type:"EA",link:function(){e.navigator.userAgent.indexOf("MSIE 9")>-1&&t(function(){var e=document.querySelectorAll("[bo-draggable]"),t=document.querySelectorAll("[data-bo-draggable]");o(e),o(t)})}}}]),function(){"use strict";angular.module("org.bonita.services.topurl",[]).service("manageTopUrl",["$window",function(e){var t={};return t.getCurrentPageToken=function(){var t=/(^|[&\?])_p=([^&]*)(&|$)/,n=t.exec(e.top.location.hash);return n&&n.length?n[2]:""},t.addOrReplaceParam=function(n,r){if(void 0!==r&&e.self!==e.top){var o=t.getCurrentPageToken();if(e.top.location.hash){var a=new RegExp("(^|[&\\?])"+o+n+"=[^&]*(&|$)"),i=e.top.location.hash.match(a);if(i&&i.length){var l="";r&&(l=o+n+"="+r),e.top.location.hash=e.top.location.hash.replace(a,"$1"+l+"$2")}else{var c=e.top.location.hash;r&&(e.top.location.hash+=(c.indexOf("&",c.length-2)>=0?"":"&")+o+n+"="+r)}}else r&&(e.top.location.hash="#"+o+n+"="+r)}},t.getCurrentProfile=function(){if(e&&e.top&&e.top.location&&e.top.location.hash){var t=e.top.location.hash.match(/\b_pf=\d+\b/);return t&&t.length?t[0]:""}},t.getPath=function(){return e.top.location.pathname},t.getSearch=function(){return e.top.location.search||""},t.getUrlToTokenAndId=function(e,n){return t.getPath()+t.getSearch()+"#?id="+(e||"")+"&_p="+(n||"")+"&"+t.getCurrentProfile()},t.goTo=function(n){var r=n.token;if(r){var o="&";n&&angular.forEach(n,function(e,t){t&&e&&"token"!==t&&(o+=r+t+"="+e+"&")}),e.top.location.hash="?_p="+r+"&"+t.getCurrentProfile()+o}},t}])}(),angular.module("bonita.selectable",["bonitable"]).directive("boSelectall",function(){return{restrict:"A",require:"^bonitable",replace:!0,template:'<input type="checkbox" ng-checked="$allSelected" ng-click="$toggleAll()">',link:function(e,t){e.$watch(function(){return e.$indeterminate},function(e){t[0].indeterminate=e})}}}).directive("boSelector",function(){return{restrict:"A",require:"^bonitable",link:function(e,t,n,r){function o(){e.$apply()}function a(){r.unregisterSelector(l)}var i=t.controller("ngModel"),l={data:e.$eval(n.boSelector),isChecked:function(){return i&&i.$modelValue===!0||t[0].checked},setChecked:function(e){i?(i.$setViewValue(e===!0),i.$render()):t[0].checked=e}};t.on("change",o),e.$on("$destroy",a),r.registerSelector(l)}}}),angular.module("bonita.repeatable",["bonitable"]).service("domAttributes",function(){this.copy=function(e,t,n){[].slice.call(e.attributes).forEach(function(r){t.setAttribute(r.name,e.getAttribute(r.name)),n&&e.removeAttribute(r.name)})}}).directive("columnTemplate",["$compile","domAttributes",function(e,t){return{restrict:"A",scope:!0,link:function(n,r,o){var a=angular.element(o.columnTemplate),i=angular.element("<div></div>");t.copy(a[0],i[0],!1);var l=e(i.append(a.contents()))(n.$parent);t.copy(i[0],r[0],!0),r.append(l)}}}]).directive("boRepeatable",function(){return{require:"bonitable",restrict:"A",compile:function(e,t){function n(e){return null===e.th.getAttribute("data-ignore")}function r(e,t){return t[e]===!0}function o(e,t){var n=document.createElement(e);return n.setAttribute("column-template",t),n.setAttribute("ng-repeat","column in $columns | filter:$visibilityFilter"),n}var a=t[this.name]||"thead tr:last-child",i="tr[ng-repeat]",l=e[0].querySelector(a),c=e[0].querySelector(i);if(!l||!c||l.children.length!==c.children.length)throw new Error("bo-repeatable th number does not correspond to td number. please verify you html table");var u,s=[],p=c.children;[].some.call(l.children,function(e,t){return u=t,null===e.getAttribute("data-ignore")});var d=t.visibleProp||"visible";s=[].map.call(l.children,function(e,t){return{th:e,td:p[t]}}).filter(n).map(function(e){angular.element(e.th).remove(),angular.element(e.td).remove();var t={name:e.th.textContent,header:e.th.outerHTML,cell:e.td.outerHTML};return t[d]=!0,t});var g=o("th","{{::column.header}}"),f=o("td","{{::column.cell}}");return l.insertBefore(g,l.children[u]),c.insertBefore(f,c.children[u]),function(e){e.$columns=s,e.$visibilityFilter=r.bind(null,d)}}}}).directive("repeatableConfig",function(){return{priority:1,require:"bonitable",link:function(e,t,n){e.$watch(n.repeatableConfig,function(t){var r=n.visibleProp||"visible";if(t.length!==e.$columns.length)throw new Error("repeatable-config size differ from $columns size. Please check your config attr");e.$columns.forEach(function(e,n){e[r]=t[n]})})}}}),angular.module("bonita.sortable",["bonitable"]).directive("boSorter",function(){function e(e){return e?"DESC":"ASC"}function t(e,t){var n="boSorterTitle"+t.charAt()+t.substring(1).toLowerCase();return e[n]||"Sort by "+t}return{restrict:"A",scope:!0,require:"^bonitable",templateUrl:"template/sortable/sorter.tpl.html",transclude:!0,link:function(n,r,o,a){if(n.property=(o.boSorter||o.id||"").trim(),0===n.property.length)throw new Error("bo-sorter: no id found. Please specify on wich property the sort is applied to or add an id");n.sortOptions=a.getOptions();var i=e(n.sortOptions.direction);n.titleSortAttr=t(o,i),n.sort=function(){n.sortOptions.property===n.property?n.sortOptions.direction=!n.sortOptions.direction:(n.sortOptions.property=n.property,n.sortOptions.direction=!1),i=e(n.sortOptions.direction),n.titleSortAttr=t(o,i),a.triggerSortHandler(n.sortOptions)}}}}),angular.module("bonita.settings",["ui.bootstrap.dropdown","ui.bootstrap.buttons"]).directive("tableSettings",function(){return{templateUrl:"template/table-settings/tableSettings.tpl.html",replace:!0,scope:{columns:"=",sizes:"=",pageSize:"=",labelProp:"@",visibleProp:"@",updatePageSize:"&",updateVisibility:"&"},link:function(e,t,n){e.visible=n.visibleProp||"visible",e.label=n.labelProp||"name"}}});