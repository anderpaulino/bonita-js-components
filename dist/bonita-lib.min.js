angular.module("bonitable",[]).controller("BonitableController",["$scope",function(e){function t(e){return e.isChecked()}function n(e){return e.data}this.getOptions=function(){return e.sortOptions},this.triggerSortHandler=function(t){e.onSort({options:t})};var r=[];this.registerSelector=function(e){r.push(e)},this.unregisterSelector=function(e){var t=r.indexOf(e);r=r.slice(0,t).concat(r.slice(t+1))};var o={$selectedItems:function(){return r.filter(t).map(n)},$allSelected:function(){return this.$selectedItems.length===r.length},$indeterminate:function(){return this.$selectedItems.length!==r.length&&this.$selectedItems.length>0}};this.prepareScope=function(e){Object.keys(o).forEach(function(e){Object.defineProperty(this,e,{get:o[e],enumerable:!0,iterable:!0})},e),e.$toggleAll=function(){var e=!this.$allSelected;r.forEach(function(t){t.setChecked(e)})}}}]).directive("bonitable",function(){return{priority:100,scope:{onSort:"&",sortOptions:"=",repeatableConfig:"="},transclude:"element",controller:"BonitableController",compile:function(){return function(e,t,n,r,o){o(function(e,n){r.prepareScope(n),t.after(e)})}}}}),function(){"use strict";angular.module("org.bonita.services.topurl",[]).service("manageTopUrl",["$window",function(e){var t={};return t.getCurrentPageToken=function(){var t=/(^|[&\?])_p=([^&]*)(&|$)/,n=t.exec(e.top.location.hash);return n&&n.length?n[2]:""},t.addOrReplaceParam=function(n,r){if(void 0!==r&&e.self!==e.top){var o=t.getCurrentPageToken();if(e.top.location.hash){var i=new RegExp("(^|[&\\?])"+o+n+"=[^&]*(&|$)"),l=e.top.location.hash.match(i);if(l&&l.length){var a="";r&&(a=o+n+"="+r),e.top.location.hash=e.top.location.hash.replace(i,"$1"+a+"$2")}else{var c=e.top.location.hash;r&&(e.top.location.hash+=(c.indexOf("&",c.length-2)>=0?"":"&")+o+n+"="+r)}}else r&&(e.top.location.hash="#"+o+n+"="+r)}},t.getCurrentProfile=function(){if(e&&e.top&&e.top.location&&e.top.location.hash){var t=e.top.location.hash.match(/\b_pf=\d+\b/);return t&&t.length?t[0]:""}},t.getPath=function(){return e.top.location.pathname},t.getSearch=function(){return e.top.location.search||""},t.getUrlToTokenAndId=function(e,n){return t.getPath()+t.getSearch()+"#?id="+(e||"")+"&_p="+(n||"")+"&"+t.getCurrentProfile()},t}])}(),angular.module("bonita.selectable",[]).directive("boSelectall",function(){return{restrict:"A",require:"^bonitable",replace:!0,template:'<input type="checkbox" ng-checked="$allSelected" ng-click="$toggleAll()">',link:function(e,t){e.$watch(function(){return e.$indeterminate},function(e){t[0].indeterminate=e})}}}).directive("boSelector",function(){return{restrict:"A",require:"^bonitable",link:function(e,t,n,r){function o(){e.$apply()}function i(){r.unregisterSelector(a)}var l=t.controller("ngModel"),a={data:e.$eval(n.boSelector),isChecked:function(){return l&&l.$modelValue===!0||t[0].checked},setChecked:function(e){l?(l.$setViewValue(e===!0),l.$render()):t[0].checked=e}};t.on("change",o),e.$on("$destroy",i),r.registerSelector(a)}}}),angular.module("bonita.repeatable",[]).directive("columnTemplate",["$compile",function(e){return{restrict:"A",scope:{template:"=columnTemplate"},link:function(t,n){var r=angular.element(t.template),o=angular.element("<div></div>");angular.forEach(r[0].attributes,function(e){o.attr(e.name,r.attr(e.name))}),n.append(e(o.append(r.contents()))(t.$parent))}}}]).directive("boRepeatable",function(){return{require:"bonitable",restrict:"A",compile:function(e,t){function n(e){return null===e.th.getAttribute("data-ignore")}function r(e,t){return t[e]===!0}function o(e,t){var n=document.createElement(e);return n.setAttribute("column-template",t),n.setAttribute("ng-repeat","column in $columns | filter:$visibilityFilter"),n}var i=t[this.name]||"thead tr:last-child",l="tr[ng-repeat]",a=e[0].querySelector(i),c=e[0].querySelector(l);if(!a||!c||a.children.length!==c.children.length)throw new Error("bo-repeatable th number does not correspond to td number. please verify you html table");var u,s=[],p=c.children;[].some.call(a.children,function(e,t){return u=t,null===e.getAttribute("data-ignore")});var h=t.visibleProp||"visible";s=[].map.call(a.children,function(e,t){return{th:e,td:p[t]}}).filter(n).map(function(e){angular.element(e.th).remove(),angular.element(e.td).remove();var t={name:e.th.textContent,header:e.th.outerHTML,cell:e.td.outerHTML};return t[h]=!0,t});var f=o("th","column.header"),d=o("td","column.cell");return a.insertBefore(f,a.children[u]),c.insertBefore(d,c.children[u]),function(e){e.$columns=s,e.$visibilityFilter=r.bind(null,h)}}}}).directive("repeatableConfig",function(){return{priority:1,require:"bonitable",link:function(e,t,n){e.$watch(n.repeatableConfig,function(t){var r=n.visibleProp||"visible";if(t.length!==e.$columns.length)throw new Error("repeatable-config size differ from $columns size. Please check your config attr");e.$columns.forEach(function(e,n){e[r]=t[n]})})}}}),angular.module("bonita.settings",["ui.bootstrap.dropdown","ui.bootstrap.buttons"]).directive("tableSettings",function(){return{templateUrl:"template/table-settings/tableSettings.tpl.html",replace:!0,scope:{columns:"=",sizes:"=",pageSize:"=",labelProp:"@",visibleProp:"@",updatePageSize:"&",updateVisibility:"&"},link:function(e,t,n){e.visible=n.visibleProp||"visible",e.label=n.labelProp||"name"}}}),angular.module("bonita.sortable",[]).directive("boSorter",function(){return{restrict:"A",scope:!0,require:"^bonitable",templateUrl:"template/sortable/sorter.tpl.html",transclude:!0,link:function(e,t,n,r){e.property=(n.id||n.boSorter).trim(),e.sortOptions=r.getOptions(),e.sort=function(){e.sortOptions.property===e.property?e.sortOptions.direction=!e.sortOptions.direction:(e.sortOptions.property=e.property,e.sortOptions.direction=!1),r.triggerSortHandler(e.sortOptions)}}}});