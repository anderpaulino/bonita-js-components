angular.module("bonitable",[]).controller("BonitableController",["$scope",function(t){function e(t){return t.isChecked()}function n(t){return t.data}this.getOptions=function(){return t.sortOptions},this.triggerSortHandler=function(e){t.onSort({options:e})};var r=[];this.registerSelector=function(t){r.push(t)},this.unregisterSelector=function(t){var e=r.indexOf(t);r=r.slice(0,e).concat(r.slice(e+1))};var o={$selectedItems:function(){return r.filter(e).map(n)},$allSelected:function(){return this.$selectedItems.length===r.length},$indeterminate:function(){return this.$selectedItems.length!==r.length&&this.$selectedItems.length>0}};this.prepareScope=function(t){Object.keys(o).forEach(function(t){Object.defineProperty(this,t,{get:o[t],enumerable:!0,iterable:!0})},t),t.$toggleAll=function(){var t=!this.$allSelected;r.forEach(function(e){e.setChecked(t)})}}}]).directive("bonitable",function(){return{priority:100,scope:{onSort:"&",sortOptions:"=",repeatableConfig:"="},transclude:"element",controller:"BonitableController",compile:function(){return function(t,e,n,r,o){o(function(t,n){r.prepareScope(n),e.after(t)})}}}}),angular.module("bonita.dragAndDrop",[]).service("boDragUtils",function(){"use strict";this.generateUniqId=function(t){return(t||"drag-")+Math.random().toString(36).substring(7)}}).directive("boDropzone",["$document","$parse","$compile","boDragUtils","boDragEvent",function(t,e,n,r,o){"use strict";function a(t,e){t.className=t.className.replace(new RegExp(" "+e),"")}var i={},l="bo-dropzone-hover";return t.on("dragover",function(t){return t.preventDefault(),t.target.hasAttribute("data-drop-id")?(-1===t.target.className.indexOf(l)&&(angular.element(document.getElementsByClassName(l)).removeClass(l),t.target.className+=" "+l),i[t.target.getAttribute("data-drop-id")].onDragOver(angular.element(t.target).scope(),{$event:t}),(t.dataTransfer||t.originalEvent.dataTransfer).dropEffect="copy",!1):void 0}),t.on("drop",function(t){if(t.preventDefault(),t.target.hasAttribute("data-drop-id")){var e=t.target.getAttribute("data-drop-id"),c=(t.dataTransfer||t.originalEvent.dataTransfer).getData("Text").split(":"),s=document.getElementById(c[0]),u=angular.element(t.target).scope(),p=u.$new(),d=angular.element(s).isolateScope().data||angular.element(s).scope().data;if("false"===c[1]){var g=s.cloneNode(!0);g.id=r.generateUniqId(),o.copy(c[0],g.id);try{g.attributes.removeNamedItem("ng-repeat")}catch(t){}return t.target.appendChild(g),p.data=d,n(angular.element(g))(p),void u.$apply(function(){a(t.target,l),i[e].onDropSuccess(u,{$data:p.data,$event:t})})}u.$apply(function(){a(t.target,l),i[e].onDropSuccess(u,{$data:d,$event:t})}),t.target.appendChild(s)}}),{type:"A",link:function(t,n,o){n.addClass("bo-dropzone-container"),o.$set("data-drop-id",r.generateUniqId("drop")),i[o["data-drop-id"]]={onDropSuccess:e(o.boDropSuccess)||angular.noop,onDragOver:e(o.boDragOver)||angular.noop}}}}]).factory("boDragEvent",function(){var t={};return{map:t,copy:function(e,n){t[n]=t[e]}}}).directive("boDraggable",["$document","boDragEvent","boDragUtils",function(t,e,n){"use strict";return t.on("dragstart",function(t){var n=t.target,r=t.dataTransfer||t.originalEvent.dataTransfer;r.effectAllowed="copy",r.setData("Text",n.id+":"+n.parentElement.hasAttribute("data-drop-id")),e.map[n.id]&&e.map[n.id].onDragStart()}),{type:"EA",scope:{data:"=boDraggableData",onDragStart:"&boDragStart"},link:function(t,r,o){o.$set("draggable",!0),o.$set("id",o.id||n.generateUniqId()),o.boDragStart&&(e.map[o.id]={onDragStart:t.onDragStart||angular.noop})}}}]).directive("boDragPolyfill",["$window",function(t){"use strict";return{type:"EA",compile:function(){var e=document.querySelectorAll("[bo-draggable]");t.navigator.userAgent.indexOf("MSIE 9")>-1&&[].forEach.call(e,function(t){var e=document.createElement("A");[].forEach.call(t.attributes,function(t){e.setAttribute(t.name,t.value)}),e.innerHTML=t.innerHTML,e.href="#",t.parentNode.replaceChild(e,t)})}}}]),function(){"use strict";angular.module("org.bonita.services.topurl",[]).service("manageTopUrl",["$window",function(t){var e={};return e.getCurrentPageToken=function(){var e=/(^|[&\?])_p=([^&]*)(&|$)/,n=e.exec(t.top.location.hash);return n&&n.length?n[2]:""},e.addOrReplaceParam=function(n,r){if(void 0!==r&&t.self!==t.top){var o=e.getCurrentPageToken();if(t.top.location.hash){var a=new RegExp("(^|[&\\?])"+o+n+"=[^&]*(&|$)"),i=t.top.location.hash.match(a);if(i&&i.length){var l="";r&&(l=o+n+"="+r),t.top.location.hash=t.top.location.hash.replace(a,"$1"+l+"$2")}else{var c=t.top.location.hash;r&&(t.top.location.hash+=(c.indexOf("&",c.length-2)>=0?"":"&")+o+n+"="+r)}}else r&&(t.top.location.hash="#"+o+n+"="+r)}},e.getCurrentProfile=function(){if(t&&t.top&&t.top.location&&t.top.location.hash){var e=t.top.location.hash.match(/\b_pf=\d+\b/);return e&&e.length?e[0]:""}},e.getPath=function(){return t.top.location.pathname},e.getSearch=function(){return t.top.location.search||""},e.getUrlToTokenAndId=function(t,n){return e.getPath()+e.getSearch()+"#?id="+(t||"")+"&_p="+(n||"")+"&"+e.getCurrentProfile()},e.goTo=function(n){var r=n.token;if(r){var o="&";n&&angular.forEach(n,function(t,e){e&&t&&"token"!==e&&(o+=r+e+"="+t+"&")}),t.top.location.hash="?_p="+r+"&"+e.getCurrentProfile()+o}},e}])}(),angular.module("bonita.selectable",["bonitable"]).directive("boSelectall",function(){return{restrict:"A",require:"^bonitable",replace:!0,template:'<input type="checkbox" ng-checked="$allSelected" ng-click="$toggleAll()">',link:function(t,e){t.$watch(function(){return t.$indeterminate},function(t){e[0].indeterminate=t})}}}).directive("boSelector",function(){return{restrict:"A",require:"^bonitable",link:function(t,e,n,r){function o(){t.$apply()}function a(){r.unregisterSelector(l)}var i=e.controller("ngModel"),l={data:t.$eval(n.boSelector),isChecked:function(){return i&&i.$modelValue===!0||e[0].checked},setChecked:function(t){i?(i.$setViewValue(t===!0),i.$render()):e[0].checked=t}};e.on("change",o),t.$on("$destroy",a),r.registerSelector(l)}}}),angular.module("bonita.repeatable",["bonitable"]).service("domAttributes",function(){this.copy=function(t,e,n){[].slice.call(t.attributes).forEach(function(r){e.setAttribute(r.name,t.getAttribute(r.name)),n&&t.removeAttribute(r.name)})}}).directive("columnTemplate",["$compile","domAttributes",function(t,e){return{restrict:"A",scope:!0,link:function(n,r,o){var a=angular.element(o.columnTemplate),i=angular.element("<div></div>");e.copy(a[0],i[0],!1);var l=t(i.append(a.contents()))(n.$parent);e.copy(i[0],r[0],!0),r.append(l)}}}]).directive("boRepeatable",function(){return{require:"bonitable",restrict:"A",compile:function(t,e){function n(t){return null===t.th.getAttribute("data-ignore")}function r(t,e){return e[t]===!0}function o(t,e){var n=document.createElement(t);return n.setAttribute("column-template",e),n.setAttribute("ng-repeat","column in $columns | filter:$visibilityFilter"),n}var a=e[this.name]||"thead tr:last-child",i="tr[ng-repeat]",l=t[0].querySelector(a),c=t[0].querySelector(i);if(!l||!c||l.children.length!==c.children.length)throw new Error("bo-repeatable th number does not correspond to td number. please verify you html table");var s,u=[],p=c.children;[].some.call(l.children,function(t,e){return s=e,null===t.getAttribute("data-ignore")});var d=e.visibleProp||"visible";u=[].map.call(l.children,function(t,e){return{th:t,td:p[e]}}).filter(n).map(function(t){angular.element(t.th).remove(),angular.element(t.td).remove();var e={name:t.th.textContent,header:t.th.outerHTML,cell:t.td.outerHTML};return e[d]=!0,e});var g=o("th","{{::column.header}}"),b=o("td","{{::column.cell}}");return l.insertBefore(g,l.children[s]),c.insertBefore(b,c.children[s]),function(t){t.$columns=u,t.$visibilityFilter=r.bind(null,d)}}}}).directive("repeatableConfig",function(){return{priority:1,require:"bonitable",link:function(t,e,n){t.$watch(n.repeatableConfig,function(e){var r=n.visibleProp||"visible";if(e.length!==t.$columns.length)throw new Error("repeatable-config size differ from $columns size. Please check your config attr");t.$columns.forEach(function(t,n){t[r]=e[n]})})}}}),angular.module("bonita.sortable",["bonitable"]).directive("boSorter",function(){function t(t){return t?"DESC":"ASC"}function e(t,e){var n="boSorterTitle"+e.charAt()+e.substring(1).toLowerCase();return t[n]||"Sort by "+e}return{restrict:"A",scope:!0,require:"^bonitable",templateUrl:"template/sortable/sorter.tpl.html",transclude:!0,link:function(n,r,o,a){if(n.property=(o.boSorter||o.id||"").trim(),0===n.property.length)throw new Error("bo-sorter: no id found. Please specify on wich property the sort is applied to or add an id");n.sortOptions=a.getOptions();var i=t(n.sortOptions.direction);n.titleSortAttr=e(o,i),n.sort=function(){n.sortOptions.property===n.property?n.sortOptions.direction=!n.sortOptions.direction:(n.sortOptions.property=n.property,n.sortOptions.direction=!1),i=t(n.sortOptions.direction),n.titleSortAttr=e(o,i),a.triggerSortHandler(n.sortOptions)}}}}),angular.module("bonita.settings",["ui.bootstrap.dropdown","ui.bootstrap.buttons"]).directive("tableSettings",function(){return{templateUrl:"template/table-settings/tableSettings.tpl.html",replace:!0,scope:{columns:"=",sizes:"=",pageSize:"=",labelProp:"@",visibleProp:"@",updatePageSize:"&",updateVisibility:"&"},link:function(t,e,n){t.visible=n.visibleProp||"visible",t.label=n.labelProp||"name"}}}),function(t){try{t=angular.module("bonita.templates")}catch(e){t=angular.module("bonita.templates",[])}t.run(["$templateCache",function(t){t.put("template/sortable/sorter.tpl.html",'<button class="bo-SortButton"\n        title="{{titleSortAttr}}"\n        ng-class="{\'bo-SortButton--active text-primary\':sortOptions.property === property}" ng-click="sort()">\n  <span class="bo-SortButton-label" ng-transclude></span>\n  <i class="bo-SortButton-icon" ng-class="{\'icon-sort-up\': !sortOptions.direction || sortOptions.property !== property, \'icon-sort-down\': sortOptions.direction && sortOptions.property === property}"></i>\n</button>\n')}])}(),function(t){try{t=angular.module("bonita.templates")}catch(e){t=angular.module("bonita.templates",[])}t.run(["$templateCache",function(t){t.put("template/table-settings/tableSettings.tpl.html",'<div class="bo-TableSettings pull-right" dropdown>\n  <button type="button"\n    id="aria-tablesettings"\n    class="btn btn-default bo-Settings dropdown-toggle"\n    title="{{\'Table settings\' | translate}}"\n    ng-disabled="tasks.length === 0"\n    aria-labelledby="aria-tablesettings">\n    <i class="icon icon-gear"></i>\n    <span class="sr-only">{{\'Table settings\' | translate}}</span>\n  </button>\n\n  <div class="bo-TableSettings-content dropdown-menu pull-right" role="menu" aria-labelledby="aria-tablesettings">\n    <h5 class="bo-TableSettings-title" >{{\'Items per page \'| translate}}</h5>\n    <div class="btn-group btn-group-justified" role="group">\n      <div class="btn-group" role="group" ng-repeat="size in sizes">\n        <button class="btn btn-default"\n          type="button"\n          ng-model="$parent.pageSize" btn-radio="{{::size}}"\n          ng-change="updatePageSize({size:size})" tabindex="0">\n          {{size}}\n        </button>\n      </div>\n    </div>\n\n    <h5 class="bo-TableSettings-title" >{{\'Columns Selection\' | translate}}</h5>\n    <ul class="bo-TableSettings-columns">\n      <li  ng-repeat="field in columns">\n      <label\n        class="bo-TableSettings-column"\n        title="{{::((field.selected ? \'Hide\' : \'Show\') +\' \'+ field[label])}}"\n        ng-click="$event.stopPropagation()">\n        <input type="checkbox" ng-model="field[visible]" ng-change="updateVisibility({field:field})">\n        {{::field[label]}}\n      </label>\n      </li>\n    </ul>\n  </div>\n</div>\n')}])}();